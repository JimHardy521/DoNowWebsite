<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GCSE Maths - Do Now</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>body {
  font-family: 'Inter', sans-serif;
  margin: 0;
  background-color: #f0f4f8;
  color: #333;
}</style>

<link rel="stylesheet" href="style.css">

<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<script src="gcsequestions.js"></script>

</head>

<body>

<h1>GCSE Maths – Do Now</h1>

<div class="button-bar">
  <select id="levelSelect">
    <option value="Foundation">Foundation</option>
    <option value="Crossover">Crossover</option>
    <option value="Higher" selected>Higher</option>
  </select>

  <button onclick="loadQuestions()">New Questions</button>
  <button onclick="printQuestions()">Print Questions</button>
</div>

<div id="questions"></div>

<hr>

<p style="text-align:center;font-weight:700;">
  … or create a Do Now using specific topics:
</p>

<div class="topic-toolbar">
  <div class="topic-wrapper"><label>Question 1 Topic</label><select id="topic1"></select></div>
  <div class="topic-wrapper"><label>Question 2 Topic</label><select id="topic2"></select></div>
  <div class="topic-wrapper"><label>Question 3 Topic</label><select id="topic3"></select></div>
  <div class="topic-wrapper"><label>Question 4 Topic</label><select id="topic4"></select></div>
  <div class="topic-wrapper"><button onclick="loadTopicQuestions()">Load Topic Questions</button></div>
</div>

<script>
  function randomFrom(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }
  
  function getSelectedLevel() {
    return document.getElementById("levelSelect").value;
  }
  
  // ---------------- TOPICS ----------------
  
  function populateAllTopics() {
    const level = getSelectedLevel();
    const topics = [...new Set(
      gcseQuestions.filter(q => q.level === level).map(q => q.topic)
    )];
  
    ["topic1","topic2","topic3","topic4"].forEach(id => {
      const sel = document.getElementById(id);
      sel.innerHTML = "";
      topics.forEach(t => {
        const o = document.createElement("option");
        o.value = t;
        o.textContent = t;
        sel.appendChild(o);
      });
    });
  }
  
  document.getElementById("levelSelect").addEventListener("change", () => {
    populateAllTopics();
    loadQuestions();
  });
  
  // ---------------- QUESTION BOX ----------------
  
  function createBox(q, index) {
    const box = document.createElement("div");
    box.className = "question-box";
  
    const h = document.createElement("div");
    h.className = "question-header";
    h.innerHTML = `Question ${index + 1}: ${q.topic}`;
    box.appendChild(h);
  
    const qt = document.createElement("div");
    qt.innerHTML = q.question;
    box.appendChild(qt);
  
    const sol = document.createElement("div");
    sol.className = "solution";
    sol.innerHTML = `<strong>Solution:</strong> ${q.solution}`;
    box.appendChild(sol);
  
    box.onclick = () =>
      sol.style.display = sol.style.display === "none" ? "block" : "none";
  
    const r = document.createElement("div");
    r.className = "refresh-btn";
    r.innerHTML = "↻";
    r.onclick = e => {
      e.stopPropagation();
      const pool = gcseQuestions.filter(q => q.level === getSelectedLevel());
      let nq;
      do { nq = randomFrom(pool); } while (nq.question === q.question);
      qt.innerHTML = nq.question;
      sol.innerHTML = `<strong>Solution:</strong> ${nq.solution}`;
      h.innerHTML = `Question ${index + 1}: ${nq.topic}`;
      MathJax.typeset();
    };
    box.appendChild(r);
  
    document.getElementById("questions").appendChild(box);
  }
  
  // ---------------- LOAD QUESTIONS ----------------
  
  function loadQuestions() {
    document.getElementById("questions").innerHTML = "";
    const pool = gcseQuestions.filter(q => q.level === getSelectedLevel());
  
    for (let i = 0; i < 4; i++) {
      createBox(randomFrom(pool), i);
    }
  
    MathJax.typeset();
  }
  
  // ---------------- LOAD TOPIC QUESTIONS ----------------
  
  function loadTopicQuestions() {
    document.getElementById("questions").innerHTML = "";
    const level = getSelectedLevel();
  
    ["topic1","topic2","topic3","topic4"].forEach((id, i) => {
      const topic = document.getElementById(id).value;
      const filtered = gcseQuestions.filter(
        q => q.level === level && q.topic === topic
      );
      if (filtered.length) {
        createBox(randomFrom(filtered), i);
      }
    });
  
    MathJax.typeset();
  }

  // ---------------- PRINT ----------------

function printQuestions() {
  const boxes = document.querySelectorAll(".question-box");
  let questions = [];

  boxes.forEach(b => {
    questions.push({
      header: b.querySelector(".question-header").innerHTML,
      question: b.children[1].innerHTML
    });
  });

  // duplicate for cut-and-fold
  questions = questions.concat(questions);

  const win = window.open("", "_blank");
  win.document.write(`
  <html>
  <head>
    <style>
      @page { size: A4; margin: 5mm; }
      body { font-family: Inter, Arial, sans-serif; margin: 0; }
      .page {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }
      .box {
        border: 1px solid black;
        padding: 8px;
        font-size: 14px;
        min-height: 190px;
      }
      .cut { border-top: 2px dashed black; margin: 10px 0; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"><\/script>
  </head>
  <body>
    <div class="page">
      ${questions.slice(0,4).map(q =>
        `<div class="box"><strong>${q.header}</strong><br>${q.question}</div>`
      ).join("")}
    </div>
    <div class="cut"></div>
    <div class="page">
      ${questions.slice(4,8).map(q =>
        `<div class="box"><strong>${q.header}</strong><br>${q.question}</div>`
      ).join("")}
    </div>
  </body>
  </html>
  `);
  win.document.close();
  win.onload = () => win.MathJax.typesetPromise().then(() => win.print());
}
  
  // INIT
  populateAllTopics();
  loadQuestions();
  </script>

<script src="common.js"></script>

<script>
  createNavBar();
</script>

</body>
</html>
